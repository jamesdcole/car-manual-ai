<!DOCTYPE html>
<html>
<head>
  <title>Garage Mechanic AI</title>
  <style>
    body { font-family: Arial; max-width: 800px; margin: 50px auto; padding: 20px; }
    select, input, button { padding: 10px; margin: 10px 0; font-size: 16px; }
    #answer { background: #f5f5f5; padding: 20px; border-radius: 8px; margin-top: 20px; white-space: pre-wrap; }
    h1 { color: #2c5530; }
  </style>
</head>
<body>
  <h1>ðŸ”§ Garage Mechanic AI</h1>
  
  <!-- CAR SELECTOR -->
  <div>
    <label>Choose Car Manual:</label>
    <select id="carSelect">
      <option value="toyota-highlander.pdf">Toyota Highlander</option>
      <option value="toyota-camry.pdf">Toyota Camry</option>
      <option value="honda-pilot.pdf">Honda Pilot</option>
      <option value="ford-explorer.pdf">Ford Explorer</option>
    </select>
  </div>

  <!-- QUESTION -->
  <input type="text" id="question" placeholder="oil drain plug torque?" style="width: 70%;">
  <button onclick="askMechanic()">Ask Mechanic</button>

  <!-- ANSWER -->
  <div id="answer">Ask about torque specs, procedures, diagrams...</div>

 <script>
    async function askMechanic() {
      const filename = document.getElementById('carSelect').value;
      const question = document.getElementById('question').value;
      const answerDiv = document.getElementById('answer');
      
      answerDiv.textContent = 'Mechanic is checking the manual...';
      
      try {
        const response = await fetch('https://us-central1-car-manual-ai-5c053.cloudfunctions.net/ask', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ filename, template question })
        });
        
        const data = await response.json();
        answerDiv.innerHTML = data.answer;
        
        // ðŸ”¥ DIAGRAM BUTTON MAGIC
        if (data.answer.includes('Page') && (data.answer.includes('Fig') || data.answer.includes('Figure') || data.answer.includes('DIAGRAM'))) {
          const pageMatch = data.answer.match(/Page (\d+)/i);
          if (pageMatch) {
            const pageNum = pageMatch[1];
            const filename = document.getElementById('carSelect').value;
            answerDiv.innerHTML += `
              <br><br>
              <button onclick="viewPage('${filename}', ${pageNum})" 
                      style="background:#2c5530;color:white;padding:12px;border:none;border-radius:5px;font-size:16px;cursor:pointer;">
                ðŸ“– View Diagram - Page ${pageNum}
              </button>
            `;
          }
        }
      } catch (error) {
        answerDiv.textContent = 'Error: ' + error.message;
      }
    }

    // Enter key support
    document.getElementById('question').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') askMechanic();
    });

    // ðŸ”¥ VIEW PAGE FUNCTION
    function viewPage(filename, page) {
      window.open(`https://firebasestorage.googleapis.com/v0/b/car-manual-ai-5c053.appspot/o/manuals%2F${filename}?alt=media#page=${page}`, '_blank');
    }
  </script>
</body>
</html>
